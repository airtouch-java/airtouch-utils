package airtouch.v4.handler;

import static org.junit.Assert.assertEquals;

import org.junit.Test;

import airtouch.Response;
import airtouch.exception.UnknownAirtouchResponseException;
import airtouch.MessageType;
import airtouch.utils.HexString;

public class MessageHandlerTest {

    @Test
    public void test() {
        // This data is copied from AirTouch4 protocol doc page 8.
        // 5555 b080 01 2b 000c 40640000ff0041e41a806180 6579
        //                      ^----- data block -----^
        String dataBlockHexString = "5555b080012b000c40640000ff0041e41a8061806579";
        byte[] messsageBytes = HexString.toByteArray(dataBlockHexString);
        MessageHandler messageHandler = new MessageHandler();
        Response response = messageHandler.handle(messsageBytes);
        assertEquals(MessageType.ZONE_STATUS, response.getMessageType());
    }

    @Test(expected=UnknownAirtouchResponseException.class)
    public void testStrangeMessage() {
        //
        String dataBlockHexString = "5555B080073700208000800080008000000000008000800000000000800080000000000080008000A7A9";
        byte[] messsageBytes = HexString.toByteArray(dataBlockHexString);
        MessageHandler messageHandler = new MessageHandler();
        messageHandler.handle(messsageBytes);
    }

    @Test(expected=UnknownAirtouchResponseException.class)
    public void testStrangeMessage2() {
        //
        String dataBlockHexString = "5555B080002F01C403FF64842126100010160000048100000000000000000000000000000000000000000000000000000000"
                + "506F6C796169726500000000000000003201043900040D0080881F1D1E10554E495431000000000"
                + "4000080881F1D2010554E495432000000000"
                + "4000080881F1D2010554E495433000000000"
                + "4000080881F1D2010554E4954340000004D617374657200004C657669000000004769726C730000004A65766F6E00000047726F757035000047726F757036000047726F757037000047726F757038000047726F757039000047726F757041000047726F757042000047726F757043000047726F757044000047726F757045000047726F757046000047726F7570470000FFFFFFFF80004769726C730000000400464156320000000000004641563300000000000046415634000000000000800080000000000000000000000000004010110053C0000001004000FFE7FFFE02004000FFE7FFFE03004000FFE7FFFE4080118053E7418A118A53C7429911995387438011805407446419003E87456419003E87466419003E87476419003E87486419003E87496419003E874A6419003E874B6419003E874C6419003E874D6419003E874E6419003E874F6419003E870FA4";
        byte[] messsageBytes = HexString.toByteArray(dataBlockHexString);
        MessageHandler messageHandler = new MessageHandler();
        messageHandler.handle(messsageBytes);
    }

    @Test(expected=UnknownAirtouchResponseException.class)
    public void testLongMessage() {
        String dataBlockHexString ="5555B080043D0104080100200030657665206C6F7700790000000000000001001601111A800080001A1A8000011F73747564790000008000000000000000010013003F1A800080001A1A8000027F6D6F726E206F6E00F9030000000000000100041E131A800080001A1A8000837F6F66662065766500FF03000000000000010080001A1A140080001A1A8000047F6F6E20616E6F6F6EFF0300000000000001000E0F131A100080001A1A8000857F6D6F726E206F6666FF03000000000000010080001A1A063780001A1A8000067F636174636F6C640008000000000000000000001E141A800080001A1A800007306C6F77776B656E64FF0300000000000001001600111A810080001A1A8000CE31";
        byte[] messsageBytes = HexString.toByteArray(dataBlockHexString);
        MessageHandler messageHandler = new MessageHandler();
        messageHandler.handle(messsageBytes);
    }
    @Test(expected=UnknownAirtouchResponseException.class)
    public void testLongMessage2() {
        String dataBlockHexString ="5555B080002F01C403FF243920341000110000000A8100000000000000000000000000000000000000000000000000000000436F6C652046616D696C790000000000A38D0C3F000A0D0080881F1D1E10554E495431000000000A000080881F1D2010554E495432000000000A000080881F1D2010554E495433000000000A000080881F1D2010554E4954340000004C6976696E67000052756D70757300004D656469610000004D6173746572204241726C616E2042004B616964656E204248656964692042005374756479000000456E7472792048574C6472792048570047726F757042000047726F757043000047726F757044000047726F757045000047726F757046000047726F7570470000FFFFFFFF800062656473000000006800616C6C6F6E000000FF036D61696E6F6E0000F9036C6976696E6700000100800080000000000000000000000000004040150067C0000001005500FFE7FFFE02005600FFE7FFFE03005700FFE7FFFE009415805C00019416805CE0029416805DA003A814805B60048016805A80058016805A60069414805A6047B715B758C0088A16805BE0098016805B004A6419003E874B6419003E874C6419003E874D6419003E874E6419003E874F6419003E873FDF";
        byte[] messsageBytes = HexString.toByteArray(dataBlockHexString);
        MessageHandler messageHandler = new MessageHandler();
        messageHandler.handle(messsageBytes);
    }
}
